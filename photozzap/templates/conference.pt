<!DOCTYPE html>
<html lang="en" ng-app="conferenceModule">
<head>
<title>Conference</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- google fonts -->
<link href='http://fonts.googleapis.com/css?family=Pathway+Gothic+One|Raleway:700' rel='stylesheet' type='text/css'>
<!-- css files -->
<link tal:repeat="file css_files" tal:attributes="href file" rel="stylesheet" media="screen">

<style type="text/css">
#loading-screen {
    z-index: 5; 
    position: fixed;
    left: 0%;
    top: 0%;    
    width: 100%;
    height: 100%;
    font-size: 32px; 
    color: #FFFFFF;
    background-color: #000000;
}
#loading-screen .loading-screen-content {
    margin-top: 30%;
    text-align: center;
}
#loading-screen .loading-screen-content p {
    margin-top: 20px;
}
#photozzap-title {
    font-size: 52px;
}
</style>

</head>
<body ng-controller="AppCtrl">
<script tal:repeat="file javascript_files" tal:attributes="src file"  defer></script>
<script type="text/javascript">
function ready_for_connection() {
    connection_initialize("${login}", "${password}", "${bosh_service}", "${conference}");
}
</script>

<script type="text/html" id="user-wrapper-template">
<![CDATA[
    <div id="<%= this.element_id %>" class="image-preview">
    </div>
]]>
</script>

<script type="text/html" id="user-inner-template">
<![CDATA[
    <a href="#">
        <% if (this.viewing != undefined ) { %>        
            <img src="<%= this.viewing.thumbnail_url() %>" class="notification-thumbnail" />
        <% } else { %>
            <img data-src="holder.js/200x150/text:Not Viewing Any Photos"/>
        <% }; %>
        <div class="notification-overlay">
            <div style="height: 10px;"/>            
            <img src="${icon_files['eye_gray']}" class="action-icon"/><b><%= this.nick %></b>
        </div>
    </a>
]]>
</script>

<script type="text/html" id="combined-notification-template2">
<![CDATA[
    <div id="<%= this.element_id %>" class="image-preview">
		<img src="<%= this.image.thumbnail_url() %>" class="notification-thumbnail" />
		<div class="notification-overlay">
			<div style="height: 10px;"/>
		
			<span class="timestamp" title="<%= this.timestamp.toISOString() %>"><%= this.timestamp %></span>

			<!-- user uploaded -->
			<% if( this.user_added != undefined ) { %>
				<div>
					<img src="${icon_files['upload_gray']}" class="action-icon"/><b><%= this.user_added %></b>
				</div>
			<% } %>            

			<!-- viewing -->
			<div>            
			<% if( this.users_viewing.length >= 1 ) { 
				var nick_array = new Array();
				for( i in this.users_viewing ) {
					nick_array.push(this.users_viewing[i]);
				}
				var nick_string = nick_array.join(", ");
				%>
				<img src="${icon_files['eye_gray']}" class="action-icon"/><b><%= nick_string %></b>
			<% } %>
			</div>
			
			<!-- comments -->
			<div>
			<% if( this.comments.length >= 1 ) { 
				  var comments = this.comments;
				  if (comments.length > 3) {
					comments = comments.slice(-3);
				  }
				  for( i in comments) { 
				   comment = comments[i];
				%>
					<img src="${icon_files['comment_small_gray']}" class="action-icon"/>
					<b>
					   <%= comment.user %>:
					</b> <%= comment.text.trunc(30) %><br/>
				<% } %>
			<% } %>            
			</div>            
		</div>
    </div>
]]>
</script>


<script type="text/html" id="image-template">
<![CDATA[
    <li id="<%= this.thumbnail_id %>" style="display: table; margin-right: -60px;">
        <a href="#" style="display: table-cell;">
            <img src="<%= this.thumbnail_url() %>" class="notification-thumbnail"/>
        </a>

        <img class="comments-available" src="${icon_files['comment_big_white']}" style="visibility: hidden;"/>
        
    </li>
]]>
</script>

<script type="text/html" id="comment-list-template">
<![CDATA[
    <div id="<%= this.element_id %>" class="comment-holder" style="display: none;">
    </div>
]]>
</script>

<script type="text/html" id="comment-template">
<![CDATA[

    <div class="row-fluid comment-entry new-comment" style="display: none;">
        <div class="span5">
            <div class="comment-graphic-heading">
                <img src="${icon_files['comment_medium_darkgray']}">
            </div>
            <span class="comment-nick-heading"><%= this.user %></span>
            <span class="comment-timestamp unapplied-timestamp" title="<%= this.timestamp.toISOString() %>">
            <%= this.timestamp %>
            </span>                 
        </div>
        <div class="span7 comment-text">
            <%= this.text %>
        </div>
    </div>
]]>
</script>                        

<script type="text/html" id="nickname-panel-template">
<![CDATA[
    <div id="change-nickname-form">
        <form class="form-inline" style="text-align: center;">
            <span><%= this.status %></span>
            <input id="chosen-nickname2" type="text" class="input-small" placeholder="Nickname">
            <button id="join-conference2" type="button" class="btn">OK</button>
        </form>
    </div>
]]>
</script>                        

<script type="text/html" id="main-image-template">
<![CDATA[
    <img id="displayed-image" src="<%= this.url %>" style="display: none;" onload="$(document).trigger('resize_image');"/>
]]>
</script>                        


<div id="upload-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="upload-modal-label" aria-hidden="true">
    <div class="modal-header">
        <h3 id="upload-modal-label">Upload Photo</h3>
    </div>
    <div class="modal-body">
        <div id="upload-controls" style="text-align: center;">
            <div id="dragdrop_area" style="height: 150px; background-color: #DDDDDD; border-style: dashed; border-width: 3px;">
                <h3 style="margin-top: 50px;">Drag And Drop photos into this area</h3>
                Or
                <input name="file" type="file" class="cloudinary-fileupload" data-cloudinary-field="image_id"></input>
            </div>
        </div>
    </div>
</div>

<div id="toolbar-top">
</div> 


<div id="control_event_layer">
    <div id="mouse_event_layer">
    </div>

    <div ng-controller="TopSidebarCtrl">
        <div id="top-sidebar-icon" class="action-sidebar top-sidebar-icon"  ng-style="element_style()">
            <div class="action-sidebar-header action-sidebar-header-centered">
                <div class="status-sidebar-content">

                </div>
                <table>
                    <tr>
                        <td>
                            <div ng-click="expand()">
                                <img src="${icon_files['gallery_medium_white']}" />
                                <br/>
                                Photos
                            </div>
                        </td>
                        <td>
                            <div onclick="show_upload_modal();">
                                <img src="${icon_files['upload_photo_white']}" />
                                <br/>
                                Upload
                            </div>                        
                        </td>
                        <td>
                            <p style="font-size: 26px; font-weight: bold; margin-top: 5px; margin-right: 5px;">Welcome <span id="user-nickname"></span> <span id="following_nick" style="font-style:italic; font-size: 14px;"></span></p>                                        
                        </td>                        
                    </tr>
               </table>
               <div class="status-sidebar-content">
                   <div id="nickname-change-container">
                   </div>        
                    <div id="progress-container" style="display:none;">
                        <div id='progress-bar'>
                            <div class="progress" style="margin-bottom: 3px;">
                                <div class="bar" style="width: 100%;"></div>
                            </div>
                        </div>
                        <div id='progress-bar-label'></div>
                    </div>                   
               </div>
            </div>
        </div>

        <div id="gallery-sidebar" class="action-sidebar action-sidebar-expanded gallery-sidebar gallery-sidebar-{{class_state()}} sidebar-transitions action-sidebar-active"  ng-style="element_style()">
            <div id="gallery-sidebar-header" class="action-sidebar-header">
                <img ng-click="collapse()" src="${icon_files['slide_up_white']}" />
                <img src="${icon_files['gallery_medium_white']}" />
                <br/>
                Photos
            </div>
            <div id="gallery-sidebar-content">
                <ul id="image-list" class="thumbnails">
                    <li id="image-placeholder" style="display: table;">
                        <a href="#" onclick="show_upload_modal();" style="display: table-cell;">
                            <img class="notification-thumbnail" data-src="holder.js/266x200/auto/text:Upload Photo"/>
                        </a>
                    </li>            
                </ul>
            </div>
        </div>
    </div>

    <div ng-controller="SidebarCtrl">
        <div id="history-sidebar-icon" class="action-sidebar history-sidebar-icon" ng-click="expand()" ng-hide="expanded" ng-style="element_style()">
            <div class="action-sidebar-header action-sidebar-header-centered">
                <img src="${icon_files['clock_medium_white']}" />
                <br/>
                History
            </div>
        </div>

        <div id="history-sidebar" class="action-sidebar action-sidebar-expanded history-sidebar history-sidebar-{{class_state()}} sidebar-transitions action-sidebar-active" ng-style="element_style()">
            <div id="history-sidebar-header" class="action-sidebar-header">
                <img ng-click="collapse()" src="${icon_files['slide_right_white']}" />
                <img src="${icon_files['clock_medium_white']}" />
                <br/>
                History
            </div>
            <div id="history-sidebar-content">
            </div>
        </div>
    </div>

    <div ng-controller="SidebarCtrl">
        <div id="users-sidebar-icon" class="action-sidebar users-sidebar-icon" ng-click="expand()" ng-hide="expanded" ng-style="element_style()">
            <div class="action-sidebar-header action-sidebar-header-centered">
                <img src="${icon_files['users_medium_white']}" />
                <br/>
                Users
            </div>
        </div>

        <div id="users-sidebar" class="action-sidebar users-sidebar users-sidebar-{{class_state()}} sidebar-transitions action-sidebar-expanded action-sidebar-active" ng-style="element_style()">
            <div id="users-sidebar-header" class="action-sidebar-header">
                <img src="${icon_files['users_medium_white']}" />
                <br/>
                Users
                <img ng-click="collapse()" src="${icon_files['slide_left_white']}" />
            </div>
            <div id="users-sidebar-content">
            </div>
        </div>
    </div>

    <div ng-controller="SidebarCtrl">
        <div id="chat-sidebar-icon" class="action-sidebar chat-sidebar-icon" ng-click="expand()" ng-hide="expanded" ng-style="element_style()">
            <div class="action-sidebar-header action-sidebar-header-centered">
                <img src="${icon_files['chat_medium_white']}" />
                <br/>
                Chat
            </div>
        </div>

        <div id="chat-sidebar" class="action-sidebar action-sidebar-expanded chat-sidebar chat-sidebar-{{class_state()}} sidebar-transitions action-sidebar-active" ng-style="element_style()">
            <div id="chat-sidebar-header" class="action-sidebar-header">
                <img ng-click="collapse()" src="${icon_files['slide_down_white']}" />
                <img src="${icon_files['chat_medium_white']}" />
                <br/>
                Chat
            </div>
            <div id="chat-sidebar-content" class="container-fluid">
                <div id="comment_area" class="row-fluid" >
                    <div id="comment_list_area" class="row-fluid comment-list content">
                    </div>
                </div>    
            </div>	
            <div id="chat-sidebar-input" class="row-fluid chat-input" style="text-align: center;">
                <form class="form-inline comment-submit-area">
                    <img src="${icon_files['comment_medium_darkgray']}" />
                    <input id="comment-input" type="text" class="input-xlarge" placeholder="Type your comment here">
                    <button id="comment-submit" class="btn">Send</button>
                </form>
            </div>    
        </div>
    </div>

</div>    
    
<div id="notification-area">
</div>

<div id="main_image" ng-controller="ImageCtrl">
    <div id="displayed_image" class="image-container">
        <img ng-if="showing_image()" id="displayed-image" ng-src="{{image_src()}}"
            onload="$(document).trigger('resize_image');" />
    </div>
    <div id="blur_image" class="image-container">
        <img ng-if="showing_image()" id="blurred-image" ng-src="{{blur_src()}}"
            onload="$(document).trigger('resize_image');" />
    </div>
</div>

<div id="loading-screen">
    <div class="loading-screen-content">
        <span id="photozzap-title">Photozzap</span>
        <p id="connection-status-text">Please wait, loading</p>
    </div>
</div>

<!-- contains all loaded images so that they remain in the browser cache -->
<div id="image-cache" style="display:none;">
</div>


</body>
</html>