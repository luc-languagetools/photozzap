<!DOCTYPE html>
<html lang="en" ng-app="photozzap-home">
<head>
<title>Photozzap - Realtime Photo Sharing</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- google fonts -->
<link href='http://fonts.googleapis.com/css?family=Pathway+Gothic+One|Raleway:700' rel='stylesheet' type='text/css'>

<link tal:repeat="file css_files" tal:attributes="href file" rel="stylesheet" media="screen">
<script tal:repeat="file javascript_files" tal:attributes="src file"></script>

    <style type="text/css">
      body {
        padding-top: 0px;
        padding-bottom: 0px;
        font-family: 'Pathway Gothic One', sans-serif;
        font-size: 18px;        
        color: #444444;        
      }

      /* Custom container */
      .container-narrow {
        margin: 0 auto;
        max-width: 800px;
      }
      .container-narrow > hr {
        margin: 30px 0;
      }
      
      .container {
        width: auto;
      }

      /* Main marketing message and sign up button */
      .jumbotron {
        margin-top: 5px;
        text-align: center;
      }
      .intro h1 {
        font-size: 200%;
        line-height: 1;
      }

      .intro h2 {
        font-size: 125%;
        line-height: 1;
      }
      
      .intro .btn {
        margin-top: 3%;
        margin-bottom: 0%;
        font-size: 150%;
        padding: 14px 24px;
      }

      .small-print {
        font-size: 90%;
      }
      
      .section1 {
        background-color: #CCCCCC;
        box-shadow: 0px 0px 8px 3px #222222;

        background: rgb(244,250,255); /* Old browsers */
        background: -moz-linear-gradient(top,  rgba(244,250,255,1) 0%, rgba(149,186,216,1) 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(244,250,255,1)), color-stop(100%,rgba(149,186,216,1))); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top,  rgba(244,250,255,1) 0%,rgba(149,186,216,1) 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top,  rgba(244,250,255,1) 0%,rgba(149,186,216,1) 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top,  rgba(244,250,255,1) 0%,rgba(149,186,216,1) 100%); /* IE10+ */
        background: linear-gradient(to bottom,  rgba(244,250,255,1) 0%,rgba(149,186,216,1) 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f4faff', endColorstr='#95bad8',GradientType=0 ); /* IE6-9 */

        padding-top: 3%;
        padding-bottom: 3%;
      }
      
      .section2 {
      }
      
      .section3 {
        margin-top: 10%;
        background-color: #CCCCCC;
        box-shadow: 0px 0px 8px 3px #222222;
        
background: rgb(251,239,252); /* Old browsers */
background: -moz-linear-gradient(top,  rgba(251,239,252,1) 0%, rgba(255,255,255,1) 100%); /* FF3.6+ */
background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(251,239,252,1)), color-stop(100%,rgba(255,255,255,1))); /* Chrome,Safari4+ */
background: -webkit-linear-gradient(top,  rgba(251,239,252,1) 0%,rgba(255,255,255,1) 100%); /* Chrome10+,Safari5.1+ */
background: -o-linear-gradient(top,  rgba(251,239,252,1) 0%,rgba(255,255,255,1) 100%); /* Opera 11.10+ */
background: -ms-linear-gradient(top,  rgba(251,239,252,1) 0%,rgba(255,255,255,1) 100%); /* IE10+ */
background: linear-gradient(to bottom,  rgba(251,239,252,1) 0%,rgba(255,255,255,1) 100%); /* W3C */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fbeffc', endColorstr='#ffffff',GradientType=0 ); /* IE6-9 */



        padding-top: 3%;
        padding-bottom: 3%;      
      }
      
      .feature-icon-container {
        padding-top: 10%;
        text-align: center;
      }
      .feature-icon {
        display: inline-block;
        text-align: center;
        font-size: 40px;
        border-radius: 50%;
        border-color: #444444;
        border-style: solid;
        border-width: 2px;
        height: 60px;
        width: 60px;
      }
      
      .container-narrow hr {
        margin-top: 3px;
        margin-bottom: 3px;
      }
      .likebox {
        text-align: center;
      }
      
    </style>
    
    <script>
   
    function randomString(length) {
        var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'.split('');

        if (! length) {
            length = Math.floor(Math.random() * chars.length);
        }

        var str = '';
        for (var i = 0; i < length; i++) {
            str += chars[Math.floor(Math.random() * chars.length)];
        }
        return str;
    }   
   
    var app = angular.module("photozzap-home", ["firebase", "ui.bootstrap"]);
    
    function PhotozzapHomeController($scope, $firebase, $modal, $log) { 
       
        $scope.open_add_conf_modal = function() {
            $log.info("PhotozzapHomeController.open_add_conf_modal");
            $scope.modalInstance = $modal.open({templateUrl: "create_conf_modal.html",
                                                controller: PhotozzapNewConfModalController});
        };
        
        $scope.cancel = function() {
            $log.info("PhotozzapHomeController.cancel");
        };
        
    }
    
    function PhotozzapNewConfModalController($scope, $rootScope, $modalInstance, $firebase, $firebaseSimpleLogin, $log, $window) {
        $scope.form_data = {};
        $scope.form_data.logged_in = false;
        var firebaseRef = new Firebase("${firebase}");
        $scope.alerts = [];
   
        $scope.init = function() {
            $scope.login_obj = $firebaseSimpleLogin(firebaseRef);
            $scope.login_obj.$getCurrentUser().then(function(user){
                $log.info("getCurrentUser: ", user);
                if (user == null) {
                    // need to login
                    $scope.login_obj.$login('anonymous');
                }
            });
        }
   
        $rootScope.$on("$firebaseSimpleLogin:login", function(e, user) {
            $log.info("User " + user.id + " logged in");
            $scope.form_data.logged_in = true;
            $scope.global_user_object = $firebase(new Firebase("${firebase}users/" + user.uid));
        });
        
        $rootScope.$on("$firebaseSimpleLogin:error", function(e, error) {
            $scope.alerts.push({type: 'info', msg: "Logged out"});
            $scope.form_data.logged_in = false;
        });        
        
        $scope.init();
        
        $scope.closeAlert = function(index) {
            $scope.alerts.splice(index, 1);
        };        
        
        $scope.logout = function() {
            $scope.login_obj.$logout();
        };
        
        $scope.ok = function () {
            $scope.create_unique_conf_key($scope.form_data.confname, $scope.login_obj.user.uid);
        };
        
        $scope.create_unique_conf_key = function(confName, owner_uid) {
            // set owner nickname
            $scope.global_user_object.$update({nickname: $scope.global_user_object.nickname});
        
            var prefix = randomString(6);
            var confNameEncoded = confName.replace(/[^a-zA-Z0-9]/g, "-");
            var tentativeConfKey = prefix + "-" + confNameEncoded;
            var confRef = new Firebase("${firebase}conferences/" + tentativeConfKey);
            confRef.on('value', function(snapshot) {
                confRef.off('value');
                if(snapshot.val() === null) {
                    $log.info("conference " + tentativeConfKey + " does not exist, creating");
                    var conferences_node = $firebase(new Firebase("${firebase}conferences"));
                    var conference_node = conferences_node.$child(tentativeConfKey);
                    var conf_url = "${new_conf_url}".replace("new-conference-template", tentativeConfKey);
                    var permanent_conf_url = "${permanent_conf_url}".replace("new-conference-template", tentativeConfKey);
                    var conference_data = {name: confName,
                                 url: conf_url,
                                 permanent_url: permanent_conf_url,
                                 servername: "${server_name}",
                                 owner_uid: owner_uid,
                                 status: "open",
                                 notify_pushover: false,
                                 create_time: new Date().getTime(),
                                 close_after_time: new Date().getTime() + 7 * 24 * 60 * 60 * 1000}; // shutdown after 7 days
                    // alert("setting conference data: " + JSON.stringify(conference_data));
                    conference_node.$update(conference_data).then(function(ref) {
                        $scope.status = "conference " + tentativeConfKey + " created";
                        $window.location.href = conf_url;
                    });

                    // $scope.$apply();
                    // redirect to conference URL
                } else {
                    $log.info("conference " + tentativeConfKey + " already exists, trying again");
                    $scope.create_unique_conf_key(confName, owner_uid);
                }
            });            
        };
        
        $scope.cancel = function () {
            $modalInstance.dismiss('cancel');
        };        
    }
    
    </script>   

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', '${tracking_id}', 'photozzap.com');
      ga('send', 'pageview');
    </script>
    
  </head>

  <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=230215589885";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>  

   
    
    <div class="container">

      <div class="row section1">
        <div class="col-md-5 col-lg-6" ng-controller="PhotozzapHomeController">
            <script type="text/ng-template" id="create_conf_modal.html">
                <div class="modal-header">
                    <h3>Create new Photozzap Conference</h3>
                    <p>Your conference and photos will stay online for 7 days, after which they will be
                    automatically deleted.</p>                    
                </div>
                <div class="modal-body">
                    <alert ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">{{alert.msg}}</alert>
                    <form name="form.form" class="form-horizontal" role="form">
                        <div class="form-group has-feedback" ng-class="{'has-error': form.form.nickname.$invalid, 'has-success': form.form.nickname.$valid}">
                            <label class="control-label col-sm-4" for="nickname">Nickname
                                <small ng-show="form.form.nickname.$error.minlength"><br/>Min 3 characters</small>
                                <small ng-show="form.form.nickname.$error.maxlength"><br/>Max 30 characters</small>
                            </label>
                            <div class="col-sm-8">
                            <input type="text" name="nickname" class="form-control" id="nickname" 
                              ng-model="global_user_object.nickname" 
                              ng-minlength="3"
                              ng-maxlength="30"
                              placeholder="Enter your nickname" required>
                            <span class="form-control-feedback" ng-class="{'icon-checkmark': form.form.nickname.$valid, 'icon-close': form.form.nickname.$invalid}" ></span>
                            </div>
                        </div>
                        <div class="form-group has-feedback" ng-class="{'has-error': form.form.name.$invalid, 'has-success': form.form.name.$valid}">
                            <label class="control-label col-sm-4" for="confName">Conference Name
                                <small ng-show="form.form.name.$error.minlength"><br/>Min 3 characters</small>
                                <small ng-show="form.form.name.$error.maxlength"><br/>Max 30 characters</small>
                            </label>
                            <div class="col-sm-8">
                            <input type="text" name="name" class="form-control" id="confName" 
                              ng-model="form_data.confname" 
                              ng-minlength="3"
                              ng-maxlength="30"
                              placeholder="Enter a description, for example 'my photos'" required>
                            <span class="form-control-feedback" ng-class="{'icon-checkmark': form.form.name.$valid, 'icon-close': form.form.name.$invalid}" ></span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success btn-lg" ng-click="ok()"  ng-disabled="form.form.$invalid || ! form_data.logged_in">
                        <span class="icon-checkmark"></span> OK</button>
                    <button class="btn btn-default btn-lg" ng-click="cancel()">
                        <span class="icon-close"></span> Cancel</button>
                    <button class="btn btn-default btn-lg" ng-click="logout()">
                        <span class="icon-close"></span> Logout</button>                        
                </div>
            </script>        
          <div class="intro">
            <h3><span class="icon-image"></span> Photozzap</h3>
            <h1>Share and Browse Photos in Real Time</h1>
            <h2>Want to show a few photos to friends or family online ? <b><span class="icon-image"></span> Photozzap</b> is a web app which turns photo viewing into an interactive experience, allowing you to see what photos your friends are looking at, and take turns in controlling the slideshow.</h2>
            <div style="text-align: center;">
                <a id='new-conf-button' class="btn btn-large btn-success" ng-click='open_add_conf_modal()'>
                <span class="icon-redo"></span> Start Conference</a>
                <p class="small-print">Free, no registration.</p>
            </div>
          </div>
        </div>
        <div class="col-md-7 col-lg-6">
            <img class="img-responsive" src="http://res.cloudinary.com/photozzap/image/upload/c_scale,w_800/v1399380199/photozzap_header_n4snin.png"/>
        </div>
      </div>

      <div class="row section2">
        <div class="col-md-12" style="text-align: center;">
            <h1>Features</h1>
            <h3>See what Photozzap does differently</h3>
        </div>
      </div>
      <div class="row section2">
        <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
            <div class="feature-icon-container"><div class="feature-icon"><span class="icon-users3"></span></div></div>
            <h3>Interactive Photo Viewing</h3>
            View photos together. Use the Look Here or Follow Me buttons to show friends the photo you are currently looking at.
            You can see which photo they are looking at in the Users tab.
        </div>
        <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
            <div class="feature-icon-container"><div class="feature-icon"><span class="icon-lightning"></span></div></div>
            <h3>Instant Photo Gallery</h3>
            Create a photo gallery faster than any other site out there. Just type your nickname, the gallery name, click OK and start uploading pictures. No registration needed.
        </div>        
        <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
            <div class="feature-icon-container"><div class="feature-icon"><span class="icon-mobile"></span></div></div>
            <h3>Desktop, Tablet and Mobile Friendly</h3>
            Create or view photos on your desktop PC/Mac, iPad, iPhone or Android phone. The interface and photos are resized based on which device you are using.
        </div>        
        <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
            <div class="feature-icon-container"><div class="feature-icon"><span class="icon-lock"></span></div></div>
            <h3>Privacy Oriented</h3>
            No registration needed, no social media integration. Only people who have the URL can access your pictures. Pictures don't stay online forever, you can remove them immediately, or they get deleted after 7 days.
        </div>                
      </div>
      
      <div class="row section3">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12" style="text-align: center;">
                    <h1>Stay in Touch</h1>
                    <h3>What we've been up to recently, and how to contact us.</h3>
                </div>
            </div>
              <div class="row">
                <div class="col-xs-12 col-sm-6 col-md-4">
                    <div class="feature-icon-container"><div class="feature-icon"><span class="icon-radio"></span></div></div>
                    <h3>Recent Changes</h3>
                    <h4>2014-05-06</h4>
                    Official launch of Photozzap 2.0
                </div>
                <div class="col-xs-12 col-sm-6 col-md-4">
                    <div class="feature-icon-container"><div class="feature-icon"><span class="icon-envelop"></span></div></div>
                    <h3>Questions ?</h3>
                    Do you have any questions or suggestions regarding Photozzap ? You can use our Facebook page, or 
                    <a href="ma&#105;lto&#58;ph&#37;6Ft%6&#70;%7&#65;za&#112;%40&#109;a&#105;lc&#46;ne%74">Email Us</a>.
                    We'd love to hear your feedback.
                </div>                
                <div class="col-xs-12 col-sm-12 col-md-4 likebox">
                    <div class="feature-icon-container"><div class="feature-icon"><span class="icon-facebook"></span></div></div>
                    <h3>Facebook</h3>
                    <div class="fb-like-box" data-href="http://www.facebook.com/photozzap" data-width="280" data-colorscheme="light" data-show-faces="false" data-header="false" data-stream="true" data-show-border="false"></div>
                </div>                
              </div>
             <div class="row">
                <div class="col-md-12" style="text-align: center;">
                &copy; Photozzap 2014 - running on ${server_name}
                </div>
             </div>
          </div>
       </div>

    </div> <!-- /container -->


</body>
</html>
